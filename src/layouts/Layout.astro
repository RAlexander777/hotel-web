---
/* src/layouts/Layout.astro */
import "../styles/global.css";
import Navbar from "../components/Navbar.astro";
import Footer from "../components/Footer.astro";
import BookingModal from '../components/BookingModal.astro';
import { Image, getImage } from 'astro:assets';

// IMPORTACION DE IMG
import wsp from '../assets/images/Whatsapp_logo.svg';

// ... (Tus imports de clientes se mantienen igual) ...
import client1 from '../assets/images/clientes/pareja-de-turistas-en-isla-taquile-hostal-acuarius-puno.png';
import client2 from '../assets/images/clientes/turista-de-hostal-acuarius-en-isla-los-uros-con-ropa-nativa-puno.png';
import client3 from '../assets/images/clientes/turista-de-hostal-acuarius-en-isla-los-uros-puno.png';
import client4 from '../assets/images/clientes/turista-feliz-en-instalaciones-de-hostal-acuarius-puno.jpg';
import client5 from '../assets/images/clientes/turistas-a-la-luz-del-sol-en-isla-taquile-hostal-acuarius-puno.png';
import client6 from '../assets/images/clientes/turistas-de-hostal-acuarius-en-excursion-puno.png';
import client7 from '../assets/images/clientes/turistas-desayunando-en-hostal-acuarius-puno.jpg';
import client8 from '../assets/images/clientes/turistas-en-el-lobby-de-hostal-acuarius-puno.png';
import client9 from '../assets/images/clientes/turistas-sonrientes-en-el-lobby-de-hostal-acuarius-puno.png';
import client10 from '../assets/images/clientes/varios-turistas-en-el-lobby-de-hostal-acuarius-puno.png';
import client11 from '../assets/images/clientes/varios-turistas-saludando-en-el-lobby-de-hostal-acuarius-puno.png';

const { title = "Hostal Acuarius Puno", isIndexPage = false, lang = "es" } = Astro.props;

const reviews = [
    {
        type: "review",
        author: "Llique (Perú)",
        rating: 5,
        text: "La ubicación es excepcional, cerca a la plaza y a diversos lugares. De muy fácil acceso, ni que decir de la señora María, un amor de persona, ella y su familia. ¡Me sentí muy a gusto!",
        source: 'Booking.com',
        source_icon: 'fas fa-suitcase'
    },
    {
        type: "review",
        author: "Penélope (España)",
        rating: 5,
        text: "La ubicación del hotel era cercana a la plaza de armas. La señora que nos atendió era muy amable, y como teníamos que madrugar nos hizo un pequeño picnic. Las camas eran muy cómodas y espaciosas.",
        source: 'Booking.com',
        source_icon: 'fas fa-suitcase'
    },
    {
        type: "review",
        author: "Eder (España)",
        rating: 5,
        text: "El desayuno es genial y abundante. Las chicas del personal se muestran muy atentas y amables. La habitación estupenda, contaba con todo lo necesario.",
        source: 'Booking.com',
        source_icon: 'fas fa-suitcase'
    },
    {
        type: "review",
        author: "Gimenez (Argentina)",
        rating: 5,
        text: "La atención de María muy amable, atenta, disponible en todo momento.",
        source: 'Booking.com',
        source_icon: 'fas fa-suitcase'
    },
    {
        type: "review",
        author: "Monika (Reino Unido)",
        rating: 5,
        text: "The location is great, 5 minutes from main square. The LOVELY lady despite no english could not be more helpfull! She allowed us into the room at 6am straight from the bus.",
        source: 'Booking.com',
        source_icon: 'fas fa-suitcase'
    },
    {
        type: "review",
        author: "Zaviera (Países Bajos)",
        rating: 4,
        text: "The location was perfect. Nice host. She made the breakfast earlier for us due to a trip. Clean rooms. Warm water.",
        source: 'Booking.com',
        source_icon: 'fas fa-suitcase'
    },
    {
        type: "review",
        author: "Lisa (Francia)",
        rating: 5,
        text: "Le personnel est une petite famille adorable qui veille à ce que tout se passe bien. Les lits sont comfortables et l'emplacement est parfait à côté de la place des armes. Le rapport qualité prix est excellent. Je recommande.",
        source: 'Google.com',
        source_icon: 'fab fa-google'
    },
    {
        type: "review",
        author: "Luciano (Eslovenia)",
        rating: 5,
        text: "Great value for this low price. The staff very kind and helpfull, they arranged the tours and the taxies. Breakfast included in the price - amazing! Super clean.",
        source: 'Booking.com',
        source_icon: 'fas fa-suitcase'
    },
];

const optimizedPhotos = await Promise.all([
    getImage({ src: client1, width: 400, format: 'webp', alt: "Pareja de turistas del Hostal Acuarius en la Isla Taquile, Puno" }),
    getImage({ src: client2, width: 400, format: 'webp', alt: "Turista del Hostal Acuarius con ropa nativa en la Isla Los Uros, Puno" }),
    getImage({ src: client3, width: 400, format: 'webp', alt: "Turista del Hostal Acuarius visitando la Isla Los Uros, Puno" }),
    getImage({ src: client4, width: 400, format: 'webp', alt: "Turista feliz en las instalaciones del Hostal Acuarius, Puno" }),
    getImage({ src: client5, width: 400, format: 'webp', alt: "Turistas del Hostal Acuarius en la Isla Taquile, Puno" }),
    getImage({ src: client6, width: 400, format: 'webp', alt: "Grupo de turistas del Hostal Acuarius en una excursión en Puno" }),
    getImage({ src: client7, width: 400, format: 'webp', alt: "Turistas desayunando en el comedor del Hostal Acuarius, Puno" }),
    getImage({ src: client8, width: 400, format: 'webp', alt: "Turistas en el lobby del Hostal Acuarius, Puno" }),
    getImage({ src: client9, width: 400, format: 'webp', alt: "Turistas sonrientes en la recepción del Hostal Acuarius, Puno" }),
    getImage({ src: client10, width: 400, format: 'webp', alt: "Varios turistas esperando en el lobby del Hostal Acuarius, Puno" }),
    getImage({ src: client11, width: 400, format: 'webp', alt: "Varios turistas saludando desde el lobby del Hostal Acuarius, Puno" }),
]);

const photoItems = optimizedPhotos.map(photo => ({
    type: "photo",
    src: photo.src, 
    alt: photo.attributes.alt, 
}));

const carouselItems = [...reviews, ...photoItems];
---

<!doctype html>
<html lang={lang} class="bg-black text-white font-cormorant" data-theme="light">
    <head>
        <script src="/scripts/reveal.js" type="module"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous" />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Numans&family=Rethink+Sans:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Numans&display=swap" rel="stylesheet" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />

        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        
        <link rel="manifest" href="/site.webmanifest">
        
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <title>{title}</title>
    </head>
    <body>
        <Navbar brand="Hostal Acuarius" isIndex={isIndexPage} lang={lang} />

        <main>
            <slot />
        </main>

        <Footer lang={lang} />

        <a
            href="https://api.whatsapp.com/send?phone=51944278647&text=Hola,%20quisiera%20hacer%20una%20consulta%20sobre%20el%20Hostal%20Acuarius."
            class="whatsapp-fab"
            target="_blank"
            aria-label="WhatsApp"
        >
            <Image 
                src={wsp} 
                alt="Contactar por WhatsApp a Hostal Acuarius" 
                width={60} 
                height={60}
            />
        </a>

        <script is:inline define:vars={{ carouselItems }}>
            // ... (Tu script del carrusel se mantiene igual) ...
            document.addEventListener("alpine:init", () => {
                Alpine.data("carousel", () => ({
                    items: carouselItems,
                    scrollPosition: 0,
                    animationFrameId: null,
                    isPaused: false,
                    speed: 0.5,
                    isDragging: false,
                    startX: 0,
                    dragThreshold: 50,
                    init() {
                        this.$nextTick(() => {
                            const track = this.$refs.track;
                            if (track.children.length === this.items.length) {
                                const cards = Array.from(track.children);
                                cards.forEach((card) => track.appendChild(card.cloneNode(true)));
                            }
                            this.startAnimation();
                        });
                    },
                    startAnimation() {
                        if (this.animationFrameId) cancelAnimationFrame(this.animationFrameId);
                        this.isPaused = false;
                        const animateScroll = () => {
                            if (this.isPaused || this.isDragging) return;
                            const track = this.$refs.track;
                            const originalContentWidth = track.scrollWidth / 2;
                            this.scrollPosition += this.speed;
                            if (this.scrollPosition >= originalContentWidth) { this.scrollPosition = 0; }
                            track.style.transform = `translateX(-${this.scrollPosition}px)`;
                            this.animationFrameId = requestAnimationFrame(animateScroll);
                        };
                        this.animationFrameId = requestAnimationFrame(animateScroll);
                    },
                    stopAnimation() {
                        this.isPaused = true;
                        if (this.animationFrameId) {
                            cancelAnimationFrame(this.animationFrameId);
                            this.animationFrameId = null;
                        }
                    },
                    next() {
                        this.stopAnimation();
                        const track = this.$refs.track;
                        if (!track.firstElementChild) return;
                        const cardWidth = track.firstElementChild.getBoundingClientRect().width;
                        const gap = parseInt(window.getComputedStyle(track).gap);
                        track.style.transition = "transform 0.5s ease-in-out";
                        track.style.transform = `translateX(-${cardWidth + gap}px)`;
                        setTimeout(() => {
                            track.style.transition = "none";
                            track.appendChild(track.firstElementChild);
                            track.style.transform = "translateX(0)";
                            this.scrollPosition = 0;
                            this.startAnimation();
                        }, 500);
                    },
                    prev() {
                        this.stopAnimation();
                        const track = this.$refs.track;
                        if (!track.firstElementChild) return;
                        const cardWidth = track.firstElementChild.getBoundingClientRect().width;
                        const gap = parseInt(window.getComputedStyle(track).gap);
                        track.style.transition = "none";
                        track.insertBefore(track.lastElementChild, track.firstElementChild);
                        track.style.transform = `translateX(-${cardWidth + gap}px)`;
                        requestAnimationFrame(() => {
                            track.style.transition = "transform 0.5s ease-in-out";
                            track.style.transform = "translateX(0)";
                        });
                        setTimeout(() => {
                            this.scrollPosition = 0;
                            this.startAnimation();
                        }, 500);
                    },
                    getStars(rating) { return "⭐".repeat(rating) + "☆".repeat(5 - rating); },
                    getPositionX(event) { return event.type.includes("mouse") ? event.pageX : event.touches[0].clientX; },
                    dragStart(event) {
                        this.stopAnimation();
                        this.isDragging = true;
                        this.startX = this.getPositionX(event);
                        this.$refs.track.style.transition = "none";
                    },
                    dragMove(event) {
                        if (!this.isDragging) return;
                        const currentX = this.getPositionX(event);
                        const moveX = currentX - this.startX;
                        this.$refs.track.style.transform = `translateX(${-(this.scrollPosition - moveX)}px)`;
                    },
                    dragEnd(event) {
                        if (!this.isDragging) return;
                        this.isDragging = false;
                        this.$refs.track.style.transition = "";
                        const finalX = event.type === "touchend" ? event.changedTouches[0].clientX : event.pageX;
                        const movedBy = finalX - this.startX;
                        if (movedBy < -this.dragThreshold) { this.next(); } 
                        else if (movedBy > this.dragThreshold) { this.prev(); } 
                        else {
                            this.$refs.track.style.transform = `translateX(-${this.scrollPosition}px)`;
                            this.startAnimation();
                        }
                    },
                }));
            });
        </script>

        <BookingModal lang={lang} />
    </body>
</html>