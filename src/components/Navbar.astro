---
import "../styles/navbar.css";
import { Image } from 'astro:assets';
import logoNavbar from '../assets/images/logo-hostal-acuarius-puno.png';

const { isIndex = false } = Astro.props;
---

<header
    x-data=`{
        scrolled: false,
        mobileMenuOpen: false,
        mobilePhoneOpen: false,
        isIndexPage: ${isIndex},
        showLogo: ${!isIndex},
        init() {
            window.addEventListener('scroll', () => {
                this.scrolled = window.scrollY > 50;
            });
            if (this.isIndexPage) {
                window.addEventListener('scroll', () => {
                    const heroHeight = window.innerHeight;
                    if (window.scrollY > heroHeight - 80) {
                        this.showLogo = true;
                    } else {
                        this.showLogo = false;
                    }
                });
            }
        },
        openBooking() {
            // Cierra el menú móvil si está abierto y abre el modal
            this.mobileMenuOpen = false;
            $dispatch('open-booking-modal');
        }
    }`
    :class="{ 'navbar-scrolled': scrolled }"
    class="custom-navbar"
>
    <div class="navbar-container">
        <div class="logo" :class="{ 'logo-visible': showLogo }">
            <a href="#">
                <Image
                    src={logoNavbar}
                    alt="Logo de Hostal Acuarius, Puno"
                    class="logo-img"
                    height={70}
                    width={280} 
                    format="webp"
                />
            </a>
        </div>

        <nav class="desktop-nav">
            <a href="#about">Nosotros</a>
            <a href="#habitaciones">Habitaciones</a>
            <a href="#tours">Tours</a>
            <a href="#galeria">Galería</a>
            <a href="#contacto">Contacto</a>
        </nav>

        <div class="navbar-actions">
            <a href="tel:+51944278647" class="navbar-phone">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                <span>Llámanos: +51 944 278 647</span>
            </a>
            
            <!-- BOTÓN ESCRITORIO: Dispara el evento -->
            <button 
                @click="openBooking()" 
                class="btn btn-nav"
                style="cursor: pointer;"
            >
                Reserva Ahora
            </button>

            <button class="mobile-phone-btn" @click="mobilePhoneOpen = !mobilePhoneOpen; mobileMenuOpen = false" aria-label="Llamar">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
            </button>
            <button
                class="hamburger"
                @click="mobileMenuOpen = !mobileMenuOpen"
                aria-label="Abrir menú"
            >
                <span :class="{ 'toggled': mobileMenuOpen }"></span>
                <span :class="{ 'toggled': mobileMenuOpen }"></span>
                <span :class="{ 'toggled': mobileMenuOpen }"></span>
            </button>
        </div>
    </div>

    <!-- Popup Móvil Teléfono -->
    <div class="mobile-phone-popup" x-show="mobilePhoneOpen" @click.outside="mobilePhoneOpen = false" x-transition style="display: none;">
        <a href="tel:+51944278647">Llamar Ahora: +51 944 278 647</a>
    </div>

    <!-- Menú Móvil -->
    <div
        class="mobile-menu"
        x-show="mobileMenuOpen"
        @click.outside="mobileMenuOpen = false"
        x-transition
        style="display: none;"
    >
        <nav>
            <a href="#about" @click="mobileMenuOpen = false">Nosotros</a>
            <a href="#habitaciones" @click="mobileMenuOpen = false">Habitaciones</a>
            <a href="#tours" @click="mobileMenuOpen = false">Tours</a>
            <a href="#galeria" @click="mobileMenuOpen = false">Galería</a>
            <a href="#contacto" @click="mobileMenuOpen = false">Contacto</a>
            
            <!-- BOTÓN MÓVIL: Dispara el evento -->
            <button 
                class="btn-reserva-mobile" 
                @click="openBooking()"
            >
                Reserva Ahora
            </button>
        </nav>
    </div>
</header>