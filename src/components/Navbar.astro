---
import "../styles/navbar.css";
import { Image } from 'astro:assets';
import logoNavbar from '../assets/images/logo-hostal-acuarius-puno.png';

// 1. Definimos la interfaz
interface Props {
    isIndex?: boolean;
    brand?: string;
    lang?: 'es' | 'en';
}

const { isIndex = false, lang = 'es' } = Astro.props;

const t = {
    es: {
        about: "Nosotros",
        rooms: "Habitaciones",
        tours: "Tours",
        gallery: "Galería",
        contact: "Contacto",
        bookBtn: "Reserva Ahora",
        call: "Llámanos"
    },
    en: {
        about: "About Us",
        rooms: "Rooms",
        tours: "Tours",
        gallery: "Gallery",
        contact: "Contact",
        bookBtn: "Book Now",
        call: "Call us"
    }
};

// 2. CORRECCIÓN TYPESCRIPT: Forzamos el tipo
const text = t[lang as keyof typeof t]; 

const targetLang = lang === 'es' ? 'en' : 'es';
const targetLabel = lang === 'es' ? 'EN' : 'ES';

// 3. CORRECCIÓN DE RUTA: Usamos BASE_URL
// import.meta.env.BASE_URL será "/hotel-web/" gracias a tu config
const base = import.meta.env.BASE_URL;

// Aseguramos que la ruta se construya bien: /hotel-web/ + en/
// La función .replace(/\/$/, '') elimina la barra final si existe para no duplicarla
const cleanBase = base.endsWith('/') ? base : `${base}/`;
const targetLink = `${cleanBase}${targetLang}/`; 
---

<header
    x-data=`{
        scrolled: false,
        mobileMenuOpen: false,
        mobilePhoneOpen: false,
        isIndexPage: ${isIndex},
        showLogo: ${!isIndex},
        init() {
            window.addEventListener('scroll', () => { this.scrolled = window.scrollY > 50; });
            if (this.isIndexPage) {
                window.addEventListener('scroll', () => {
                    this.showLogo = window.scrollY > window.innerHeight - 80;
                });
            }
        },
        openBooking() {
            this.mobileMenuOpen = false;
            $dispatch('open-booking-modal');
        }
    }`
    :class="{ 'navbar-scrolled': scrolled, 'nav-inverted': showLogo }" 
    class="custom-navbar"
>
    <div class="navbar-container">
        <div class="logo" :class="{ 'logo-visible': showLogo }">
            <a href="#">
                <Image src={logoNavbar} alt="Logo" class="logo-img" height={70} width={280} format="webp" />
            </a>
        </div>

        <nav class="desktop-nav">
            <a href="#about">{text.about}</a>
            <a href="#habitaciones">{text.rooms}</a>
            <a href="#tours">{text.tours}</a>
            <a href="#galeria">{text.gallery}</a>
            <a href="#contacto">{text.contact}</a>
        </nav>

        <div class="navbar-actions">
            <a href={targetLink} class="lang-switch">
                <i class="fas fa-globe"></i> {targetLabel}
            </a>

            <a href="tel:+51944278647" class="navbar-phone">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                <span>{text.call}: +51 944 278 647</span>
            </a>
            
            <button @click="openBooking()" class="btn btn-nav" style="cursor: pointer;">
                {text.bookBtn}
            </button>

            <button class="mobile-phone-btn" @click="mobilePhoneOpen = !mobilePhoneOpen; mobileMenuOpen = false" aria-label="Llamar">
                <i class="fas fa-phone"></i>
            </button>

            <div 
                class="mobile-phone-popup" 
                x-show="mobilePhoneOpen" 
                @click.outside="mobilePhoneOpen = false"
                x-transition
                style="display: none;"
            >
                <a href="tel:+51944278647">
                    +51 944 278 647
                </a>
            </div>

            <button class="hamburger" @click="mobileMenuOpen = !mobileMenuOpen" aria-label="Menu">
                <span :class="{ 'toggled': mobileMenuOpen }"></span>
                <span :class="{ 'toggled': mobileMenuOpen }"></span>
                <span :class="{ 'toggled': mobileMenuOpen }"></span>
            </button>
        </div>
    </div>

    <div class="mobile-menu" x-show="mobileMenuOpen" @click.outside="mobileMenuOpen = false" x-transition style="display: none;">
        <nav>
            <a href="#about" @click="mobileMenuOpen = false">{text.about}</a>
            <a href="#habitaciones" @click="mobileMenuOpen = false">{text.rooms}</a>
            <a href="#tours" @click="mobileMenuOpen = false">{text.tours}</a>
            <a href="#galeria" @click="mobileMenuOpen = false">{text.gallery}</a>
            <a href="#contacto" @click="mobileMenuOpen = false">{text.contact}</a>
            
            <a href={targetLink} style="font-size: 1rem; color: var(--color-gold);">
                <i class="fas fa-globe"></i> Switch to {lang === 'es' ? 'English' : 'Español'}
            </a>

            <button class="btn-reserva-mobile" @click="openBooking()">
                {text.bookBtn}
            </button>
        </nav>
    </div>
</header>

<style>
/* Estilo para el botón de idioma */
.lang-switch {
    color: var(--color-text-primary);
    text-decoration: none;
    font-family: "Rethink Sans", sans-serif;
    font-size: 0.9rem;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 5px 10px;
    border-radius: 20px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 5px;
}
.lang-switch:hover {
    background: var(--color-gold);
    color: var(--color-text-hero) !important;
    border-color: var(--color-gold);
}
@media (max-width: 992px) {
    .lang-switch { display: none; } /* En móvil está dentro del menú */
}
</style>